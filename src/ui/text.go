package ui

import "Famicom-emulator/ppu"

// MARK: 変数定義
var bitmapFonts = map[rune]FontTile{
	'A': {0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x00},
	'B': {0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00},
	'C': {0x3C, 0x66, 0x06, 0x06, 0x06, 0x66, 0x3C, 0x00},
	'D': {0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00},
	'E': {0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00},
	'F': {0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00},
	'G': {0x3C, 0x66, 0x06, 0x06, 0x76, 0x66, 0x3C, 0x00},
	'H': {0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00},
	'I': {0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00},
	'J': {0x06, 0x06, 0x06, 0x06, 0x06, 0x66, 0x3C, 0x00},
	'K': {0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00},
	'L': {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00},
	'M': {0x66, 0x7E, 0x7E, 0x66, 0x66, 0x66, 0x66, 0x00},
	'N': {0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00},
	'O': {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
	'P': {0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00},
	'Q': {0x3C, 0x66, 0x66, 0x66, 0x6A, 0x6C, 0x36, 0x00},
	'R': {0x7C, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x00},
	'S': {0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00},
	'T': {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},
	'U': {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
	'V': {0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00},
	'W': {0x66, 0x66, 0x66, 0x66, 0x7E, 0x7E, 0x66, 0x00},
	'X': {0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00},
	'Y': {0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00},
	'Z': {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00},
	' ': {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
}

// MRAK: FontTile の定義
type FontTile [8]uint8

// MARK: 指定された座標にタイルを描画する関数
func DrawTile(canvas *ppu.Canvas, x, y int, tile FontTile, color [3]uint8) {
	for row := range ppu.TILE_SIZE {
		line := tile[row]
		for col := range ppu.TILE_SIZE {
			// 最上位ビットから順に描画 (左から右へ)
			if (line>>(uint(ppu.TILE_SIZE-1)-col))&1 == 1 {
				canvas.SetPixelAt(uint(x)+col, uint(y)+row, color)
			}
		}
	}
}

// MARK: 指定された座標にタイルフォントを描画する関数
func DrawText(canvas *ppu.Canvas, x, y int, text string, color [3]uint8) {
	startX := x
	for _, char := range text {
		if tile, ok := bitmapFonts[char]; ok {
			DrawTile(canvas, x, y, tile, color)
		}
		x += int(ppu.TILE_SIZE)
		if x > int(canvas.Width-ppu.TILE_SIZE) {
			x = startX
			y += int(ppu.TILE_SIZE)
		}
	}
}

// MARK: 画面をクリアする関数
func ClearScreen(canvas *ppu.Canvas, color [3]uint8) {
	for y := range canvas.Height {
		for x := range canvas.Width {
			canvas.SetPixelAt(x, y, color)
		}
	}
}
